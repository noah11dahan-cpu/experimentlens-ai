{% extends "base.html" %}

{% block title %}Experiment {{ experiment.id }} â€“ ExperimentLens AI{% endblock %}

{% block content %}
  <h2>Experiment: {{ experiment.name }}</h2>

  <p>
    <strong>Hypothesis:</strong>
    {% if experiment.hypothesis %}
      {{ experiment.hypothesis }}
    {% else %}
      <em>No hypothesis provided.</em>
    {% endif %}
  </p>

  {# ðŸ”¹ AI recommendation badge (if present) #}
  {% if experiment.recommendation %}
    <p>
      <strong>Recommendation:</strong>
      {% if experiment.recommendation == "ship" %}
        <span style="color: green; font-weight: bold;">Ship</span>
      {% elif experiment.recommendation == "dont_ship" %}
        <span style="color: red; font-weight: bold;">Don't ship</span>
      {% else %}
        <span style="color: orange; font-weight: bold;">Need more data</span>
      {% endif %}
    </p>
  {% endif %}

  {# ðŸ”¹ Variant stats table #}
  <h3>Variant stats</h3>

  {% if variants %}
    <table border="1" cellpadding="6" cellspacing="0">
      <tr>
        <th>Variant</th>
        <th>Users</th>
        <th>Conversions</th>
        <th>Conversion rate</th>
        <th>Uplift vs control</th>
        <th>p-value</th>
      </tr>
      {% for v in variants %}
        <tr>
          <td>{{ v.name }}</td>
          <td>{{ v.users }}</td>
          <td>{{ v.conversions }}</td>
          <td>
            {% if v.conversion_rate is not none %}
              {{ (v.conversion_rate * 100) | round(2) }}%
            {% else %}
              â€“
            {% endif %}
          </td>
          <td>
            {% if v.uplift is not none %}
              {{ (v.uplift * 100) | round(2) }}%
            {% else %}
              â€“
            {% endif %}
          </td>
          <td>
            {% if v.p_value is not none %}
              {{ v.p_value | round(4) }}
            {% else %}
              â€“
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </table>
  {% else %}
    <p><em>No variants found for this experiment.</em></p>
  {% endif %}

  {# ðŸ”¹ AI report text #}
  {% if experiment.report_text %}
    <h3>AI analysis</h3>
    <p>{{ experiment.report_text }}</p>
    <p style="color: #666; font-size: 0.9rem; margin-top: 1rem;">
      Generated by AI using your experiment statistics.
    </p>
  {% endif %}
{% endblock %}
